name: Java CI with Maven

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checkout repository
      - uses: actions/checkout@v4

      # Step 2: Set up JDK
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          cache: maven

      # Step 3: Verify environment (optional)
      - name: Verify environment
        run: |
          java -version
          mvn -v

      # Step 4: Clean and build project
      - name: Build with Maven
        run: >
          mvn -B clean compile
          -Dfile.encoding=UTF-8
          -Dmaven.compiler.source=17
          -Dmaven.compiler.target=17
          -Dmaven.compiler.showDeprecation=true
          -Dmaven.compiler.failOnWarning=false
          -Dmaven.compiler.compilerArgs="--add-exports=jdk.compiler/com.sun.tools.javac.processing=ALL-UNNAMED --add-exports=jdk.compiler/com.sun.tools.javac.api=ALL-UNNAMED"

      # Step 5: Run your tests
      - name: Run Login Tests
	env:
          API_KEY: ${{ secrets.API_KEY }}
        run: >
          mvn test
          -Durl=http://opensource-demo.orangehrmlive.com/
          -Dbrowser=chrome
          -Denv=headless
          -DapiKey=$API_KEY
